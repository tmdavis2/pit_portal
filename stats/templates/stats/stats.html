{% extends "pages/home.html" %}
{% block content %}
<style>
  /*
    MAIN CONTAINER STYLES
  */
  
  /* page level container - centers content and sets maximum width */
  .stats-page {
    max-width: 1400px;
    margin: 60px auto;
    padding: 0 20px;
  }

  /*
    HEADER SECTION
  */
  
  /* Page header wrapper - centers text and adds spacing below */
  .stats-header {
    text-align: center;
    margin-bottom: 50px;
  }

  /* header styling */
  .stats-header h1 {
    color: #ffffff;
    font-size: 2.5rem;
    margin-bottom: 12px;
    /* Creates color gradient effect on text */
    background: linear-gradient(135deg, #ffffff 0%, #c084fc 100%);
    background-clip: text;
  }

  /* subtitle text styling */
  .stats-header p {
    color: #b0b0b0;
    font-size: 1.05rem;
  }
  
  /*
    GAME SELECTOR CARD
  */
  
  /* Container for the game dropdown */
  .game-selector-card {
    background: #1a1a1a;
    border: 1px solid rgba(168, 85, 247, 0.3);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    margin-bottom: 30px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* card title styling */
  .game-selector-card h2 {
    color: #ffffff;
    font-size: 1.5rem;
    margin-bottom: 20px;
    font-weight: 700;
  }

  /* Label for the game selector dropdown */
  .game-selector label {
    display: block;
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 12px;
    font-size: 1.05rem;
  }

  /* Dropdown select element with custom arrow */
  .game-selector select {
    width: 100%;
    padding: 14px 16px;
    /* space for drop down arrow */
    padding-right: 40px;
    border-radius: 10px;
    border: 1px solid rgba(168, 85, 247, 0.4);
    background-color: #1e1e1e;
    /* Custom SVG arrow icon for dropdown */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a855f7' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    color: #ffffff;
    font-size: 1rem;
    font-family: "Source Sans 3", sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    /* Remove default browser dropdown styling */
    appearance: none;
    -webkit-appearance: none;
  }

  /* hover for dropdown */
  .game-selector select:hover {
    border-color: rgba(168, 85, 247, 0.7);
    background-color: #232323;
  }

  /* styling for when dropdown is selected */
  .game-selector select:focus {
    outline: none;
    border-color: #a855f7;
    box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
  }
  
  /*
    MOBILE VIEW BUTTONS
  */
  
  /* Container for buttons */
  .mobile-toggle {
    /* hidden until mobile view */
    display: none;
    gap: 10px;
    margin-bottom: 20px;
  }

  /* toggle button styling */
  .toggle-btn {
    flex: 1;
    padding: 12px 20px;
    border-radius: 10px;
    background: #1e1e1e;
    border: 2px solid rgba(168, 85, 247, 0.3);
    color: #e0e0e0;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  /* styling for active toggle button */
  .toggle-btn.active {
    background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%);
    border-color: #a855f7;
    color: #ffffff;
  }
  
  /*
    SPLIT VIEW LAYOUT
  */
  
  /* Grid container for form and profile sections */
  .split-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* single card container for form and profile sections */
  .stats-card {
    background: #1a1a1a;
    border: 1px solid rgba(168, 85, 247, 0.3);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
  }

  /* hover effect */
  .stats-card:hover {
    border-color: rgba(168, 85, 247, 0.5);
  }

  /* stat card titles */
  .stats-card h2 {
    color: #ffffff;
    font-size: 1.8rem;
    margin-bottom: 24px;
    font-weight: 700;
  }
  
  /*
    FORM STYLING
  */
  
  /* Grid layout for form */
  .form-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  /* submit button styling */
  .form-container .submit-btn {
    /* spans container */
    grid-column: 1 / -1;
  }
  
  /* form field wrapper */
  .form-group {
    display: flex;
    flex-direction: column;
    text-align: left;
  }

  /* Form field labels */
  .form-group label {
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.95rem;
  }

  /* Base styling for all input and select elements */
  .form-group input,
  .form-group select {
    padding: 12px 14px;
    /* Space for dropdown arrow on selects */
    padding-right: 40px;
    border-radius: 10px;
    border: 1px solid rgba(168, 85, 247, 0.4);
    background-color: #1e1e1e;
    color: #ffffff;
    font-size: 1rem;
    font-family: "Source Sans 3", sans-serif;
    transition: all 0.3s ease;
  }

  /* Text inputs don't need extra right padding */
  .form-group input {
    padding-right: 14px;
  }

  /* same as earlier */
  /* Custom dropdown arrow for select elements */
  .form-group select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a855f7' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    /* Remove default browser dropdown arrow */
    appearance: none;
    -webkit-appearance: none;
  }

  /* hover state */
  .form-group input:hover,
  .form-group select:hover {
    border-color: rgba(168, 85, 247, 0.6);
    background-color: #232323;
  }

  /* selected state */
  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: #a855f7;
    box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
  }

  /* Remove spinner arrows from number inputs (Firefox) */
  .form-group input[type="number"] {
    -moz-appearance: textfield;
  }

  /* Remove spinner arrows from number inputs (Chrome/Safari) */
  .form-group input[type="number"]::-webkit-outer-spin-button,
  .form-group input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Auto-capitalize text inputs (for character names, etc.) */
  .form-group input[type="text"] {
    text-transform: capitalize;
  }

  /* Field-level error message styling */
  .field-error {
    color: #fca5a5;
    font-size: 0.85rem;
    margin-top: 6px;
  }

  /* Form-wide error message container */
  .form-error {
    background: rgba(239, 68, 68, 0.15);
    border: 1px solid rgba(239, 68, 68, 0.5);
    color: #fca5a5;
    padding: 16px;
    border-radius: 10px;
    margin-bottom: 20px;
    animation: slideIn 0.3s ease;
  }

  /* Animation for error message appearance */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Form submit button with gradient background */
  .submit-btn {
    background: linear-gradient(135deg, #a855f7 0%, #c084fc 100%);
    color: #ffffff;
    padding: 14px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 8px;
  }

  /* Hover effect */
  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(143, 72, 209, 0.4);
  }
  
  /*
    USERS STATS STYLING
  */
  
  /* List container for displaying user stats */
  .stat-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  /* Individual stat row - displays stat name and value */
  .stat-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(168, 85, 247, 0.15);
    color: #b0b0b0;
    font-size: 0.95rem;
  }

  /* Remove border from last stat item */
  .stat-list li:last-child {
    border-bottom: none;
  }

  /* Stat name styling */
  .stat-list strong {
    color: #ffffff;
    font-weight: 600;
    flex: 1;
    text-transform: capitalize;
  }

  /* Stat value styling */
  .stat-value {
    color: #a855f7;
    font-weight: 600;
    font-size: 1.05rem;
  }
  
  /*
    ROCKET LEAGUE STYLING
  */
  
  /* Container for rocket league section */
  .rank-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(168, 85, 247, 0.2);
  }

  /* I STOPPED MY COMMENTS HERE FOR NOW */

  .rank-section h3 {
    color: #a855f7;
    font-size: 1.1rem;
    margin-bottom: 12px;
    font-weight: 600;
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #b0b0b0;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }
  .empty-state i {
    font-size: 3rem;
    color: #a855f7;
    margin-bottom: 16px;
    display: block;
  }
  
  @media (max-width: 968px) {
    .split-container {
      grid-template-columns: 1fr;
    }
    .mobile-toggle {
      display: flex;
    }
    .stats-card.form-section,
    .stats-card.profile-section {
      display: none;
    }
    .stats-card.form-section.active,
    .stats-card.profile-section.active {
      display: block;
    }
  }
  @media (max-width: 768px) {
    .stats-page {
      margin: 40px auto;
      padding: 0 16px;
    }
    .stats-header h1 {
      font-size: 2rem;
    }
    .stats-card {
      padding: 28px;
    }
    .form-container {
      grid-template-columns: 1fr;
    }
  }
  @media (max-width: 600px) {
    .stats-page {
      margin: 30px auto;
      padding: 0 12px;
    }
    .stats-header h1 {
      font-size: 1.5rem;
    }
    .stats-card {
      padding: 20px;
    }
    .game-selector-card {
      padding: 20px;
    }
  }
</style>
<div class="stats-page">
  <div class="stats-header">
    <h1><i class="fa-solid fa-chart-simple"></i> Your Stats</h1>
    <p>Track and view your gaming performance</p>
  </div>
  
  <div class="game-selector-card">
    <h2><i class="fa-solid fa-gamepad"></i> Select a Game</h2>
    <form method="GET">
      <div class="game-selector">
        <label for="game">Choose Game:</label>
        <select name="game" id="game" onchange="this.form.submit()">
          <option value="">-- Select a game --</option>
          {% for game in games %}
            <option value="{{ game }}" {% if game == selected_game %}selected{% endif %}>{{ game }}</option>
          {% endfor %}
        </select>
      </div>
    </form>
  </div>
  
  {% if form %}
    <div class="mobile-toggle">
      <button class="toggle-btn active" onclick="toggleView('form')">
        <i class="fa-solid fa-pen"></i> Update Stats
      </button>
      <button class="toggle-btn" onclick="toggleView('profile')">
        <i class="fa-solid fa-chart-line"></i> View Stats
      </button>
    </div>
    
    <div class="split-container">
      <div class="stats-card form-section active">
        <h2>Update {{ selected_game }} Stats</h2>
        {% if form.non_field_errors %}
          <div class="form-error">
            {% for error in form.non_field_errors %}
              <p>{{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}
        <form method="POST" class="form-container">
          {% csrf_token %}
          {% for field in form %}
            <div class="form-group">
              <label for="{{ field.id_for_label }}">
                {{ field.label }}
                {% if 'time_played' in field.name %}
                  <span style="color: #808080; font-weight: normal;">(hours)</span>
                {% endif %}
              </label>
              {{ field }}
              {% if field.errors %}
                <span class="field-error">{{ field.errors.0 }}</span>
              {% endif %}
            </div>
          {% endfor %}
          <button type="submit" class="submit-btn">
            <i class="fa-solid fa-floppy-disk"></i> Save Stats
          </button>
        </form>
      </div>
      
      <div class="stats-card profile-section">
        <h2>Your {{ selected_game }} Stats</h2>
        {% if current_game_stats and current_game_stats.custom_stats %}
          <ul class="stat-list">
            {% for key, value in current_game_stats.custom_stats.items %}
              {% if not key|slice:"-5:" == "_rank" %}
                <li>
                  <strong>
                    {{ key|capfirst }}
                    {% if 'time_played' in key %}
                      <span style="color: #808080; font-weight: normal; font-size: 0.85rem;">(hours)</span>
                    {% endif %}
                  </strong>
                  <span class="stat-value">{{ value }}</span>
                </li>
              {% endif %}
            {% endfor %}
            
            {% if current_game_stats.win_percentage %}
              <li>
                <strong>Win Percentage</strong>
                <span class="stat-value">{{ current_game_stats.win_percentage }}%</span>
              </li>
            {% endif %}
          </ul>
          
          {% if selected_game == "Rocket League" %}
            {% with rank_keys=current_game_stats.custom_stats.keys %}
              {% if rank_keys %}
                <div class="rank-section">
                  <h3><i class="fa-solid fa-trophy"></i> Mode Rankings</h3>
                  <ul class="stat-list">
                    {% for key, value in current_game_stats.custom_stats.items %}
                      {% if key|slice:"-5:" == "_rank" %}
                        <li>
                          <strong>{{ key|slice:":-5"|upper }}</strong>
                          <span class="stat-value">{{ value|capfirst }}</span>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}
            {% endwith %}
          {% endif %}
        {% else %}
          <div class="empty-state">
            <i class="fa-solid fa-chart-line"></i>
            <p>No stats recorded yet</p>
            <p style="font-size: 0.9rem; color: #808080;">Fill out the form to add your first stats</p>
          </div>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="stats-card empty-state">
      <i class="fa-solid fa-gamepad"></i>
      <p>Select a game to get started</p>
      <p style="font-size: 0.9rem; color: #808080;">Choose a game from the dropdown above to track your stats</p>
    </div>
  {% endif %}
</div>
<script>
  function toggleView(view) {
    const formSection = document.querySelector('.form-section');
    const profileSection = document.querySelector('.profile-section');
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    if (view === 'form') {
      formSection.classList.add('active');
      profileSection.classList.remove('active');
      toggleBtns[0].classList.add('active');
      toggleBtns[1].classList.remove('active');
    } else {
      formSection.classList.remove('active');
      profileSection.classList.add('active');
      toggleBtns[0].classList.remove('active');
      toggleBtns[1].classList.add('active');
    }
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    const textFields = document.querySelectorAll('input[type="text"]');
    textFields.forEach(field => {
      if (field.name.includes('character') || field.name === 'most_played_character') {
        field.addEventListener('input', function(e) {
          this.value = this.value.replace(/[0-9]/g, '');
        });
        field.addEventListener('keypress', function(e) {
          if (e.key >= '0' && e.key <= '9') {
            e.preventDefault();
          }
        });
      }
    });
  });
  
  const errorBox = document.querySelector('.form-error');
  if (errorBox) {
    setTimeout(() => {
      errorBox.style.transition = 'opacity 0.8s ease';
      errorBox.style.opacity = '0';
      setTimeout(() => errorBox.remove(), 800);
    }, 6000);
  }
</script>
{% endblock %}